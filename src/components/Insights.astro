---
<<<<<<< HEAD
=======
import Serialize from "@ayco/astro-resume";
>>>>>>> 1b93670 (feat: implement iogpt)
import { ArticleData } from "@extractus/article-extractor";

export interface Props {
  article: ArticleData | null;
<<<<<<< HEAD
  prompt: string | null;
}

const { article, prompt } = Astro.props;
=======
}

const { article } = Astro.props;
const prompts = {
  summary: `As a teacher, summarize the article ${article?.title && article?.title} ${article?.author ? `by ${article?.author}` : ''} on this web page: ${article?.url} in at most three sentences only.`,
};
export type Prompts = typeof prompts;
>>>>>>> 1b93670 (feat: implement iogpt)
---

{
  article && (
    <>
      <h3>Summary</h3>
      <div id="summary-wrapper"><p class="insight-content">Loading...</p></div>
<<<<<<< HEAD
      <hr />
      <small><strong>Prompt: </strong>{prompt}</small>
=======
>>>>>>> 1b93670 (feat: implement iogpt)
    </>
  )
}

<<<<<<< HEAD
<script>
  import { deserialize } from "@ayco/astro-resume";
  import { getInsights } from "../utils/insights";
  import { AppConfig } from "../pages/index.astro";
  const { prompt, gptKey } = deserialize<AppConfig>("app-config");

  console.log(prompt)

  let insights = await getInsights(prompt, gptKey);
  try {
=======
<Serialize data={prompts} id="ai-prompt" />

<script>
  import { deserialize } from "@ayco/astro-resume";
  import { getInsights } from "../utils/insights";
  import type { Prompts } from "./Insights.astro";
  const { summary } = deserialize<Prompts>("ai-prompt");

  // summary
  let insights = await getInsights(summary);
  try {
    console.log(insights?.choices?.map((choice) => choice.message));
>>>>>>> 1b93670 (feat: implement iogpt)
    const list = document.querySelector("#summary-wrapper");
    if (list)
      list.innerHTML = insights?.choices
        ?.map((choice) => `<p class="insight-content">${choice.message.content}</p>`)
        .join("");
  } catch (e) {
    console.error(e);
  }
</script>

<style is:inline>
  p.insight-content {
    margin: 1em 0 !important;
  }
  ul, ol {
    margin-left: -25px;
  }
<<<<<<< HEAD
  hr, small {
    margin-top: 1em;
  }
=======
>>>>>>> 1b93670 (feat: implement iogpt)
</style>